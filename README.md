# Poly Flashloan Bot

An open source flashloan bot on polygon network

## Prerequisites

This flashloan bot works with [the smart contract](https://github.com/yuichiroaoki/poly-flash/blob/main/contracts/Flashloan.sol).

You need to deploy your own smart contract on polygon mainnet if you want to run this bot.

## Installation

### 1. Install [Node.js](https://nodejs.org/en/) & [yarn](https://classic.yarnpkg.com/en/docs/install/#windows-stable), if you haven't already.

### 2. Clone This Repo

Run the following command.

```bash
https://github.com/yuichiroaoki/poly-flashloan-bot.git
cd poly-flashloan-bot
```

## Quickstart

### 1. Setup Environment Variables

You'll need an ALCHEMY_POLYGON_RPC_URL environment variable. You can get one from [Alchemy website](https://alchemy.com/?r=33851811-6ecf-40c3-a36d-d0452dda8634) for free.

Then, you can create a .env file with the following.

```
ALCHEMY_POLYGON_RPC_URL='<your-own-alchemy-polygon-mainnet-rpc-url>'
```

If you want to execute flashloan on the polygon mainnet, you need to add your PRIVATE_KEY environment variable as well, [with a private key from your wallet](https://metamask.zendesk.com/hc/en-us/articles/360015289632-How-to-Export-an-Account-Private-Key).

```
PRIVATE_KEY='your-PRIVATE_KEY'
```

\*Note: If using metamask, you'll have to add a `0x` to the start of your private key)

### 2. Install Dependencies

Run the following command.

```bash
yarn install
```

### 3.Build

```bash
yarn build
```

### 4. Run Bot

```bash
yarn start
```

## Configuration

Edit [src/config.ts](https://github.com/yuichiroaoki/poly-flashloan-bot/blob/main/src/config.ts)

If you have deployed your own contract, replace `flashloan address` to your deployed smart contract address.

[flashloan address](https://github.com/yuichiroaoki/poly-flashloan-bot/blob/2778e4b5e87c261f11db56a647ac5eadf28e26c2/src/config.ts#L37)

```typescript
export const flashloanAddress = "<your-deployed-contract-address>";
```

Note: If you update the flashloan smart contract, you need to replace [this ABI](https://github.com/yuichiroaoki/poly-flashloan-bot/blob/main/src/abis/Flashloan.json) to the new one.

## ABI

This flashloan bot uses an ABI from [this flashloan smart contract](https://github.com/yuichiroaoki/poly-flash/blob/main/contracts/Flashloan.sol).

If you update the flashloan smart contract, you need to replace [this ABI](https://github.com/yuichiroaoki/poly-flashloan-bot/blob/main/src/abis/Flashloan.json) to the new one.

## Docker

```bash
source startup.sh
```

## All supported liquidity protocols

```bash
curl -X GET "https://api.1inch.exchange/v3.0/137/protocols" -H  "accept: application/json"
curl -X GET "https://api.1inch.exchange/v4.0/137/liquidity-sources" -H  "accept: application/json"
```

```json
{
  "protocols": [
    "POLYGON_SAFE_SWAP",
    "POLYGON_APESWAP",
    "IRONSWAP",
    "POLYGON_JETSWAP",
    "POLYGON_DODO",
    "POLYGON_DODO_V2",
    "POLYGON_KYBER_DMM",
    "POLYGON_BALANCER_V2",
    "POLYGON_WAULTSWAP",
    "DFYN",
    "POLYGON_ONE_INCH_LIMIT_ORDER",
    "POLYDEX_FINANCE",
    "ONESWAP",
    "FIREBIRD_FINANCE",
    "POLYGON_MSTABLE",
    "POLYGON_SUSHISWAP",
    "POLYGON_QUICKSWAP",
    "WMATIC",
    "POLYGON_CURVE",
    "POLYGON_AAVE_V2",
    "COMETH",
    "POLYGON_DFX_FINANCE",
    "POLYGON_CURVE_V2"
  ]
}
```

## All supported tokens

```bash
curl -X GET "https://api.1inch.exchange/v3.0/137/tokens" -H  "accept: application/json"
curl -X GET "https://api.1inch.exchange/v4.0/137/tokens" -H  "accept: application/json"
```

## Errors

```sh
../poly-flashloan-bot/node_modules/@ethersproject/logger/lib/index.js:199
        var error = new Error(message);
                    ^

Error: replacement fee too low (error={"reason":"processing response error","code":"SERVER_ERROR","body":"{\"jsonrpc\": \"2.0\", \"id\": 61, \"error\": {\"code\": -32000, \"message\": \"replacement transaction underpriced\"}}","error":{"code":-32000},"requestBody":"{\"method\":\"eth_sendRawTransaction\",\"params\":[\"0xf903ed2b8506fc23ac0083e4e1c094e43a0003955f8745c77a2a987afa316d6b9828b380b90384b27f6a2500000000000000000000000000000000000000000000000000000000000000200000000000000000000000005333eb1e32522f1893b7c9fea3c263807a02d56100000000000000000000000000000000000000000000000000000002540be400000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000002400000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000a5e0829caced8ffdd4de3c43696c57f7d7a678ff00000000000000000000000000000000000000000000000000000000000000030000000000000000000000002791bca1f2de4661ed88a30c99a7a9449aa84174000000000000000000000000c2132d05d31c914a87c6611c10748aeb04b58e8f000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000c0788a3ad43d79aa53b09c2eacc313a787d1d6070000000000000000000000000000000000000000000000000000000000000002000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000008f3cf7ad23cd3cadbd9735aff958023239c6a063000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000a5e0829caced8ffdd4de3c43696c57f7d7a678ff00000000000000000000000000000000000000000000000000000000000000040000000000000000000000008f3cf7ad23cd3cadbd9735aff958023239c6a063000000000000000000000000c2132d05d31c914a87c6611c10748aeb04b58e8f000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000002791bca1f2de4661ed88a30c99a7a9449aa84174820136a06804dbd52c51d16a47de35fa0d480c6e35867f66331d5d513b8996e460a4bd26a0172700c98893f38c33b181117825ca4ef805d4c8346081055bf3ebfa3b110cdd\"],\"id\":61,\"jsonrpc\":\"2.0\"}","requestMethod":"POST","url":"https://polygon-mainnet.g.alchemy.com/v2/C8hqRyZLEm-WpGcWcI61xpoQhp2qmEFd"}, method="sendTransaction", transaction="0xf903ed2b8506fc23ac0083e4e1c094e43a0003955f8745c77a2a987afa316d6b9828b380b90384b27f6a2500000000000000000000000000000000000000000000000000000000000000200000000000000000000000005333eb1e32522f1893b7c9fea3c263807a02d56100000000000000000000000000000000000000000000000000000002540be400000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000002400000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000a5e0829caced8ffdd4de3c43696c57f7d7a678ff00000000000000000000000000000000000000000000000000000000000000030000000000000000000000002791bca1f2de4661ed88a30c99a7a9449aa84174000000000000000000000000c2132d05d31c914a87c6611c10748aeb04b58e8f000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000c0788a3ad43d79aa53b09c2eacc313a787d1d6070000000000000000000000000000000000000000000000000000000000000002000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000008f3cf7ad23cd3cadbd9735aff958023239c6a063000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000a5e0829caced8ffdd4de3c43696c57f7d7a678ff00000000000000000000000000000000000000000000000000000000000000040000000000000000000000008f3cf7ad23cd3cadbd9735aff958023239c6a063000000000000000000000000c2132d05d31c914a87c6611c10748aeb04b58e8f000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000002791bca1f2de4661ed88a30c99a7a9449aa84174820136a06804dbd52c51d16a47de35fa0d480c6e35867f66331d5d513b8996e460a4bd26a0172700c98893f38c33b181117825ca4ef805d4c8346081055bf3ebfa3b110cdd", code=REPLACEMENT_UNDERPRICED, version=providers/5.5.1)
    at Logger.makeError (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/logger/lib/index.js:199:21)
    at Logger.throwError (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/logger/lib/index.js:208:20)
    at checkError (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:111:16)
    at JsonRpcProvider.<anonymous> (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:659:47)
    at step (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:48:23)
    at Object.throw (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:29:53)
    at rejected (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:21:65)
    at runMicrotasks (<anonymous>)
    at processTicksAndRejections (node:internal/process/task_queues:96:5) {
  reason: 'replacement fee too low',
  code: 'REPLACEMENT_UNDERPRICED',
  error: Error: processing response error (body="{\"jsonrpc\": \"2.0\", \"id\": 61, \"error\": {\"code\": -32000, \"message\": \"replacement transaction underpriced\"}}", error={"code":-32000}, requestBody="{\"method\":\"eth_sendRawTransaction\",\"params\":[\"0xf903ed2b8506fc23ac0083e4e1c094e43a0003955f8745c77a2a987afa316d6b9828b380b90384b27f6a2500000000000000000000000000000000000000000000000000000000000000200000000000000000000000005333eb1e32522f1893b7c9fea3c263807a02d56100000000000000000000000000000000000000000000000000000002540be400000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000002400000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000a5e0829caced8ffdd4de3c43696c57f7d7a678ff00000000000000000000000000000000000000000000000000000000000000030000000000000000000000002791bca1f2de4661ed88a30c99a7a9449aa84174000000000000000000000000c2132d05d31c914a87c6611c10748aeb04b58e8f000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000c0788a3ad43d79aa53b09c2eacc313a787d1d6070000000000000000000000000000000000000000000000000000000000000002000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000008f3cf7ad23cd3cadbd9735aff958023239c6a063000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000a5e0829caced8ffdd4de3c43696c57f7d7a678ff00000000000000000000000000000000000000000000000000000000000000040000000000000000000000008f3cf7ad23cd3cadbd9735aff958023239c6a063000000000000000000000000c2132d05d31c914a87c6611c10748aeb04b58e8f000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000002791bca1f2de4661ed88a30c99a7a9449aa84174820136a06804dbd52c51d16a47de35fa0d480c6e35867f66331d5d513b8996e460a4bd26a0172700c98893f38c33b181117825ca4ef805d4c8346081055bf3ebfa3b110cdd\"],\"id\":61,\"jsonrpc\":\"2.0\"}", requestMethod="POST", url="https://polygon-mainnet.g.alchemy.com/v2/C8hqRyZLEm-WpGcWcI61xpoQhp2qmEFd", code=SERVER_ERROR, version=web/5.5.1)
      at Logger.makeError (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/logger/lib/index.js:199:21)
      at Logger.throwError (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/logger/lib/index.js:208:20)
      at /home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/web/lib/index.js:301:32
      at step (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/web/lib/index.js:33:23)
      at Object.next (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/web/lib/index.js:14:53)
      at fulfilled (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/web/lib/index.js:5:58)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (node:internal/process/task_queues:96:5) {
    reason: 'processing response error',
    code: 'SERVER_ERROR',
    body: '{"jsonrpc": "2.0", "id": 61, "error": {"code": -32000, "message": "replacement transaction underpriced"}}',
    error: Error: replacement transaction underpriced
        at getResult (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:142:21)
        at processJsonFunc (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/web/lib/index.js:344:22)
        at /home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/web/lib/index.js:276:46
        at step (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/web/lib/index.js:33:23)
        at Object.next (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/web/lib/index.js:14:53)
        at fulfilled (/home/phil/Projects/poly-flashloan-bot/node_modules/@ethersproject/web/lib/index.js:5:58)
        at runMicrotasks (<anonymous>)
        at processTicksAndRejections (node:internal/process/task_queues:96:5) {
      code: -32000,
      data: undefined
    },
    requestBody: '{"method":"eth_sendRawTransaction","params":["0xf903ed2b8506fc23ac0083e4e1c094e43a0003955f8745c77a2a987afa316d6b9828b380b90384b27f6a2500000000000000000000000000000000000000000000000000000000000000200000000000000000000000005333eb1e32522f1893b7c9fea3c263807a02d56100000000000000000000000000000000000000000000000000000002540be400000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000002400000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000a5e0829caced8ffdd4de3c43696c57f7d7a678ff00000000000000000000000000000000000000000000000000000000000000030000000000000000000000002791bca1f2de4661ed88a30c99a7a9449aa84174000000000000000000000000c2132d05d31c914a87c6611c10748aeb04b58e8f000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000c0788a3ad43d79aa53b09c2eacc313a787d1d6070000000000000000000000000000000000000000000000000000000000000002000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000008f3cf7ad23cd3cadbd9735aff958023239c6a063000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000a5e0829caced8ffdd4de3c43696c57f7d7a678ff00000000000000000000000000000000000000000000000000000000000000040000000000000000000000008f3cf7ad23cd3cadbd9735aff958023239c6a063000000000000000000000000c2132d05d31c914a87c6611c10748aeb04b58e8f000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000002791bca1f2de4661ed88a30c99a7a9449aa84174820136a06804dbd52c51d16a47de35fa0d480c6e35867f66331d5d513b8996e460a4bd26a0172700c98893f38c33b181117825ca4ef805d4c8346081055bf3ebfa3b110cdd"],"id":61,"jsonrpc":"2.0"}',
    requestMethod: 'POST',
    url: 'https://polygon-mainnet.g.alchemy.com/v2/C8hqRyZLEm-WpGcWcI61xpoQhp2qmEFd'
  },
  method: 'sendTransaction',
  transaction: {
    nonce: 43,
    gasPrice: BigNumber { _hex: '0x06fc23ac00', _isBigNumber: true },
    gasLimit: BigNumber { _hex: '0xe4e1c0', _isBigNumber: true },
    to: '0xe43A0003955f8745c77A2A987Afa316D6B9828B3',
    value: BigNumber { _hex: '0x00', _isBigNumber: true },
    data: '0xb27f6a2500000000000000000000000000000000000000000000000000000000000000200000000000000000000000005333eb1e32522f1893b7c9fea3c263807a02d56100000000000000000000000000000000000000000000000000000002540be400000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000002400000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000a5e0829caced8ffdd4de3c43696c57f7d7a678ff00000000000000000000000000000000000000000000000000000000000000030000000000000000000000002791bca1f2de4661ed88a30c99a7a9449aa84174000000000000000000000000c2132d05d31c914a87c6611c10748aeb04b58e8f000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000c0788a3ad43d79aa53b09c2eacc313a787d1d6070000000000000000000000000000000000000000000000000000000000000002000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000008f3cf7ad23cd3cadbd9735aff958023239c6a063000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000a5e0829caced8ffdd4de3c43696c57f7d7a678ff00000000000000000000000000000000000000000000000000000000000000040000000000000000000000008f3cf7ad23cd3cadbd9735aff958023239c6a063000000000000000000000000c2132d05d31c914a87c6611c10748aeb04b58e8f000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000002791bca1f2de4661ed88a30c99a7a9449aa84174',
    chainId: 137,
    v: 310,
    r: '0x6804dbd52c51d16a47de35fa0d480c6e35867f66331d5d513b8996e460a4bd26',
    s: '0x172700c98893f38c33b181117825ca4ef805d4c8346081055bf3ebfa3b110cdd',
    from: '0x4d844504470f7E43740af80BD5462022F69FeFB0',
    hash: '0xc7d28627c5751e3d82760314fd375252d3415ee18559b1e236b2c3900c8f1bd2',
    type: null,
    confirmations: 0
  },
  transactionHash: '0xc7d28627c5751e3d82760314fd375252d3415ee18559b1e236b2c3900c8f1bd2'
}
```
